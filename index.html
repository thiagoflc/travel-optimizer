<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otimizador de Viagens - Mediterr√¢neo 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis } = window.Recharts;

        // CONSTANTS (Fix: removed magic numbers)
        const BASELINE_TRIP_DAYS = 8;
        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];
        const RADAR_SUBJECTS = ['Praia', 'Cultura', 'Gastronomia', 'Log√≠stica', 'Pet Friendly', 'Custo-Benef.'];
        // NEW RANKING SYSTEM - 100 points total
        // Bloco A - Atratividade (66 pts): CxB(18), Praia(18), Cultura(6), Diversao(10), Gastro(10), Original(4)
        // Bloco B - Viabilidade (34 pts): Logistica(18), Clima(10), Seguranca(6)
        const RANKING_WEIGHTS = {
            // Bloco A - Atratividade (66 pontos)
            custoBeneficio: 18, praia: 18, cultura: 6, diversao: 10, gastronomia: 10, originalidade: 4,
            // Bloco B - Viabilidade (34 pontos)
            logistica: 18, clima: 10, seguranca: 6
        };
        const ATRATIVIDADE_MAX = 66; // Divisor para normalizar a 100
        const VIABILIDADE_MAX = 34;

        const ROTEIROS_DATA = [
            { id: "costabrava", nome: "Costa Brava + Fran√ßa", categoria: "Surrealismo & Vinho", vibe: "Dois pa√≠ses, calas secretas e alta gastronomia.", praia: 8, cultura: 9, gastronomia: 9, custoBeneficio: 7, logistica: 9, petFriendly: 5, diversao: 7, clima: 9, originalidade: 8, seguranca: 10, custoBaseEUR: 2350, bases: [{ nome: "Begur (Espanha)", noites: 4, tipo: "Villa Design", destaque: "Calas e Vilas Medievais" }, { nome: "Collioure (Fran√ßa)", noites: 4, tipo: "Mas Catal√£o", destaque: "Vinhos e Anchovas" }], timeline: [{ dia: 1, cidade: "Barcelona", manha: "Chegada BCN", tarde: "Ida p/ Begur (1h30)", noite: "Tapas em Pals" }, { dia: 2, cidade: "Begur", manha: "Caminho de Ronda", tarde: "Cala Aiguablava", noite: "Jantar Medieval" }, { dia: 3, cidade: "Peratallada", manha: "Vila de Pedra", tarde: "Piscina Villa", noite: "Churrasco" }, { dia: 4, cidade: "Llafranc", manha: "Praia", tarde: "Farol S. Sebasti√†", noite: "Jantar Mar" }, { dia: 5, cidade: "Collioure", manha: "Cruzar Fronteira", tarde: "Check-in Fran√ßa", noite: "Vinho Banyuls" }, { dia: 6, cidade: "Collioure", manha: "Mercado Rua", tarde: "Castelo Real", noite: "Ostras e Ros√©" }, { dia: 7, cidade: "Port-Vendres", manha: "Peixaria", tarde: "Praia Racou", noite: "Jantar Estrelado" }, { dia: 8, cidade: "Barcelona", manha: "Retorno (2h)", tarde: "Voo", noite: "-" }], custos: { hospedagem: 0.45, transporte: 0.12, alimentacao: 0.33, extras: 0.10 } },
            { id: "andaluzia", nome: "Andaluzia (Espanha)", categoria: "Cultura & Tapas", vibe: "Hist√≥ria mourisca, vilas brancas e gastronomia barata.", praia: 5, cultura: 10, gastronomia: 10, custoBeneficio: 10, logistica: 9, petFriendly: 5, diversao: 9, clima: 10, originalidade: 6, seguranca: 10, custoBaseEUR: 1450, bases: [{ nome: "Nerja / Frigiliana", noites: 4, tipo: "Cortijo c/ Piscina", destaque: "Cavernas e Praias" }, { nome: "Granada / Arredores", noites: 4, tipo: "Villa Rural", destaque: "Alhambra e Tapas" }], timeline: [{ dia: 1, cidade: "M√°laga", manha: "Chegada e Carro", tarde: "Centro Hist√≥rico", noite: "Tapas Calle Larios" }, { dia: 2, cidade: "Nerja", manha: "Check-in Villa", tarde: "Praia Burriana", noite: "Jantar Balcon de Europa" }, { dia: 3, cidade: "Frigiliana", manha: "Pueblo Blanco", tarde: "Piscina na Villa", noite: "Churrasco" }, { dia: 4, cidade: "Nerja", manha: "Cuevas de Nerja", tarde: "Praia Maro", noite: "Paella no Chiringuito" }, { dia: 5, cidade: "Granada", manha: "Viagem (1h)", tarde: "Albaic√≠n (Mirantes)", noite: "Tapas Gr√°tis" }, { dia: 6, cidade: "Granada", manha: "Alhambra (Tour)", tarde: "Generalife", noite: "Show Flamenco" }, { dia: 7, cidade: "Granada", manha: "Serra Nevada (Visual)", tarde: "Compras/Relax", noite: "Jantar Despedida" }, { dia: 8, cidade: "M√°laga", manha: "Retorno Aeroporto", tarde: "Voo", noite: "-" }], custos: { hospedagem: 0.40, transporte: 0.15, alimentacao: 0.35, extras: 0.10 } },
            { id: "istria", nome: "Istria (Cro√°cia)", categoria: "Toscana do Mar", vibe: "Trufas, azeite, cidades medievais e mar esmeralda.", praia: 8, cultura: 9, gastronomia: 10, custoBeneficio: 9, logistica: 8, petFriendly: 5, diversao: 7, clima: 9, originalidade: 9, seguranca: 9, custoBaseEUR: 1750, bases: [{ nome: "Motovun (Interior)", noites: 4, tipo: "Mans√£o de Pedra", destaque: "Trufas e Vinho" }, { nome: "Rovinj (Litoral)", noites: 4, tipo: "Apto Luxo ou Villa", destaque: "P√¥r do sol e Barco" }], timeline: [{ dia: 1, cidade: "Veneza/Pula", manha: "Chegada e Carro", tarde: "Ida p/ Motovun", noite: "Jantar Trufas" }, { dia: 2, cidade: "Motovun", manha: "Ca√ßa √†s Trufas", tarde: "Piscina Villa", noite: "Vinho local" }, { dia: 3, cidade: "Gro≈ænjan", manha: "Cidade das Artes", tarde: "Degusta√ß√£o Azeite", noite: "Konoba R√∫stica" }, { dia: 4, cidade: "Poreƒç", manha: "Bas√≠lica Eufrasiana", tarde: "Praia", noite: "Jantar na Villa" }, { dia: 5, cidade: "Rovinj", manha: "Mudan√ßa Base", tarde: "Old Town Walk", noite: "Bar nas Pedras" }, { dia: 6, cidade: "Rovinj", manha: "Passeio Barco Privado", tarde: "Ilhas Vermelhas", noite: "Jantar Porto" }, { dia: 7, cidade: "Bale/Valle", manha: "Vila Medieval", tarde: "Praia de Pedra", noite: "Jantar Despedida" }, { dia: 8, cidade: "Veneza/Pula", manha: "Retorno", tarde: "Voo", noite: "-" }], custos: { hospedagem: 0.45, transporte: 0.15, alimentacao: 0.30, extras: 0.10 } },
            { id: "menorca", nome: "Menorca (Espanha)", categoria: "Sil√™ncio Turquesa", vibe: "Exclusividade, calma e praias virgens.", praia: 10, cultura: 5, gastronomia: 7, custoBeneficio: 6, logistica: 9, petFriendly: 5, diversao: 5, clima: 10, originalidade: 7, seguranca: 10, custoBaseEUR: 2550, bases: [{ nome: "Ciutadella", noites: 4, tipo: "Finca Rural", destaque: "P√¥r do Sol" }, { nome: "Mah√≥n/Sul", noites: 4, tipo: "Casa de Pedra", destaque: "Calas do Sul" }], timeline: [{ dia: 1, cidade: "Mah√≥n", manha: "Chegada", tarde: "Ida Ciutadella", noite: "Jantar Porto" }, { dia: 2, cidade: "Ciutadella", manha: "Cala Turqueta", tarde: "Centro Hist√≥rico", noite: "Farol Nati" }, { dia: 3, cidade: "Norte", manha: "Praias Vermelhas", tarde: "Piscina Finca", noite: "Queijo Mah√≥n" }, { dia: 4, cidade: "Sul", manha: "Cala Macarella", tarde: "Trilha Cavalls", noite: "Jantar Finca" }, { dia: 5, cidade: "Es Castell", manha: "Mudan√ßa Base", tarde: "Cales Fonts", noite: "Jantar Peixe" }, { dia: 6, cidade: "Binibeca", manha: "Vila Branca", tarde: "Praia Rasa", noite: "Bar Caverna" }, { dia: 7, cidade: "Mah√≥n", manha: "Passeio Barco Porto", tarde: "Compras Gin", noite: "Despedida" }, { dia: 8, cidade: "Mah√≥n", manha: "Retorno", tarde: "Voo", noite: "-" }], custos: { hospedagem: 0.50, transporte: 0.12, alimentacao: 0.30, extras: 0.08 } },
            { id: "puglia", nome: "Puglia (It√°lia)", categoria: "R√∫stico Chique", vibe: "Masserias, Trulli, marz√£o e comida farta.", praia: 8, cultura: 9, gastronomia: 10, custoBeneficio: 8, logistica: 6, petFriendly: 4, diversao: 7, clima: 9, originalidade: 8, seguranca: 9, custoBaseEUR: 1950, bases: [{ nome: "Valle d'Itria", noites: 4, tipo: "Trullo com Piscina", destaque: "Cidades Brancas" }, { nome: "Salento (Lecce)", noites: 4, tipo: "Masseria Fortificada", destaque: "Praias Maldivas" }], timeline: [{ dia: 1, cidade: "Bari", manha: "Chegada", tarde: "Polignano a Mare", noite: "Jantar na Gruta (opc)" }, { dia: 2, cidade: "Ostuni", manha: "Cidade Branca", tarde: "Piscina Trullo", noite: "Jantar Carne" }, { dia: 3, cidade: "Alberobello", manha: "Trulli (cedo)", tarde: "Locorotondo", noite: "Vinho Primitivo" }, { dia: 4, cidade: "Monopoli", manha: "Porto Antigo", tarde: "Praia Capitolo", noite: "Pizza" }, { dia: 5, cidade: "Lecce", manha: "Ida p/ Sul", tarde: "Check-in Masseria", noite: "Centro Barroco" }, { dia: 6, cidade: "Gallipoli", manha: "Praia Punta della Suina", tarde: "Centro Hist√≥rico", noite: "Peixe Fresco" }, { dia: 7, cidade: "Otranto", manha: "Ba√≠a dos Turcos", tarde: "Lago Bauxite", noite: "Jantar Fazenda" }, { dia: 8, cidade: "Bari", manha: "Retorno", tarde: "Voo", noite: "-" }], custos: { hospedagem: 0.45, transporte: 0.15, alimentacao: 0.30, extras: 0.10 } },
            { id: "sicilia", nome: "Sic√≠lia Oeste (It√°lia)", categoria: "Autenticidade Raiz", vibe: "Comida de rua barata, hist√≥ria profunda e praias naturais.", praia: 9, cultura: 10, gastronomia: 10, custoBeneficio: 9, logistica: 5, petFriendly: 2, diversao: 9, clima: 9, originalidade: 8, seguranca: 7, custoBaseEUR: 1550, bases: [{ nome: "Palermo/Cefal√π", noites: 4, tipo: "Apto Centro", destaque: "Street Food" }, { nome: "San Vito Lo Capo", noites: 4, tipo: "Casa de Praia", destaque: "Praias Caribenhas" }], timeline: [], custos: { hospedagem: 0.40, transporte: 0.15, alimentacao: 0.35, extras: 0.10 } },
            { id: "lefkada", nome: "Lefkada + Parga (Gr√©cia)", categoria: "Azul Neon", vibe: "O mar mais azul da lista, sem necessidade de ferry.", praia: 10, cultura: 5, gastronomia: 7, custoBeneficio: 8, logistica: 6, petFriendly: 4, diversao: 7, clima: 9, originalidade: 8, seguranca: 9, custoBaseEUR: 1950, bases: [{ nome: "Lefkada Oeste", noites: 4, tipo: "Villa Cliffside", destaque: "P√¥r do sol e Praias" }, { nome: "Parga (Continente)", noites: 4, tipo: "Apto Vista Mar", destaque: "Charme e Paxos" }], timeline: [{ dia: 1, cidade: "Preveza", manha: "Chegada", tarde: "Lefkada Town", noite: "Taverna" }, { dia: 2, cidade: "Agios Nikitas", manha: "Praia Milos", tarde: "Piscina Villa", noite: "Jantar Sunset" }, { dia: 3, cidade: "Porto Katsiki", manha: "Praia Famosa", tarde: "Egremni", noite: "Vila Exanthia" }, { dia: 4, cidade: "Lefkada", manha: "Aluguel Barco", tarde: "Ilhas Scorpios", noite: "Nydri" }, { dia: 5, cidade: "Parga", manha: "Viagem (1h)", tarde: "Castelo Veneziano", noite: "Jantar Porto" }, { dia: 6, cidade: "Paxos", manha: "Barco Daytrip", tarde: "Antipaxos (Azul)", noite: "Volta Parga" }, { dia: 7, cidade: "Rio Aqueronte", manha: "Caminhada Rio", tarde: "Praia Lichnos", noite: "Despedida" }, { dia: 8, cidade: "Preveza", manha: "Retorno", tarde: "Voo", noite: "-" }], custos: { hospedagem: 0.40, transporte: 0.15, alimentacao: 0.30, extras: 0.15 } },
            { id: "riviera_francesa", nome: "Riviera Francesa (Nice)", categoria: "Glamour & Status", vibe: "Fama, museus, restaurantes estrelados e tr√¢nsito.", praia: 6, cultura: 8, gastronomia: 8, custoBeneficio: 4, logistica: 9, petFriendly: 4, diversao: 7, clima: 9, originalidade: 5, seguranca: 10, custoBaseEUR: 3000, bases: [{ nome: "Nice/Antibes", noites: 8, tipo: "Apto Luxo", destaque: "Glamour e Museus" }], timeline: [], custos: { hospedagem: 0.50, transporte: 0.10, alimentacao: 0.35, extras: 0.05 } },
            { id: "kefalonia", nome: "Kefalonia (Gr√©cia)", categoria: "Ilha Dram√°tica", vibe: "Natureza selvagem, montanhas e praias de cart√£o postal.", praia: 10, cultura: 5, gastronomia: 7, custoBeneficio: 7, logistica: 4, petFriendly: 3, diversao: 5, clima: 9, originalidade: 8, seguranca: 9, custoBaseEUR: 2100, bases: [{ nome: "Fiskardo", noites: 4, tipo: "Casa Porto", destaque: "Vilarejo Charmoso" }, { nome: "Sami", noites: 4, tipo: "Villa Colina", destaque: "Praia Myrtos" }], timeline: [], custos: { hospedagem: 0.45, transporte: 0.15, alimentacao: 0.30, extras: 0.10 } },
            { id: "hvar", nome: "Cro√°cia (Split + Hvar)", categoria: "Balada & Ilhas", vibe: "Vida noturna, charme veneziano e √°gua clara.", praia: 8, cultura: 6, gastronomia: 6, custoBeneficio: 6, logistica: 5, petFriendly: 3, diversao: 10, clima: 9, originalidade: 6, seguranca: 8, custoBaseEUR: 2050, bases: [{ nome: "Split", noites: 3, tipo: "Apto Old Town", destaque: "Pal√°cio Diocleciano" }, { nome: "Hvar", noites: 5, tipo: "Villa Ilha", destaque: "Beach Clubs" }], timeline: [], custos: { hospedagem: 0.50, transporte: 0.15, alimentacao: 0.30, extras: 0.05 } },
            { id: "naxos", nome: "Gr√©cia (Naxos + Paros)", categoria: "Cl√°ssico Grego", vibe: "Vilas brancas, p√¥r do sol e vibe 'Mamma Mia'.", praia: 9, cultura: 6, gastronomia: 6, custoBeneficio: 6, logistica: 4, petFriendly: 2, diversao: 7, clima: 9, originalidade: 5, seguranca: 9, custoBaseEUR: 2200, bases: [{ nome: "Naxos", noites: 4, tipo: "Casa C√≠clades", destaque: "Portara e Praias" }, { nome: "Paros", noites: 4, tipo: "Villa Pool", destaque: "Naoussa" }], timeline: [], custos: { hospedagem: 0.45, transporte: 0.15, alimentacao: 0.30, extras: 0.10 } },
            { id: "montenegro", nome: "Montenegro", categoria: "Fiordes Dram√°ticos", vibe: "Paisagem de cinema, cidades medievais e pre√ßo baixo.", praia: 6, cultura: 6, gastronomia: 6, custoBeneficio: 9, logistica: 6, petFriendly: 1, diversao: 5, clima: 8, originalidade: 9, seguranca: 6, custoBaseEUR: 1250, bases: [{ nome: "Kotor", noites: 4, tipo: "Apto Old Town", destaque: "Fiordes e Muralhas" }, { nome: "Budva", noites: 4, tipo: "Resort Praia", destaque: "Vida Noturna" }], timeline: [], custos: { hospedagem: 0.40, transporte: 0.15, alimentacao: 0.35, extras: 0.10 } },
            { id: "albania", nome: "Riviera Albanesa", categoria: "Ex√≥tico Selvagem", vibe: "Caribe barato, aventura e infraestrutura simples.", praia: 8, cultura: 4, gastronomia: 5, custoBeneficio: 10, logistica: 4, petFriendly: 1, diversao: 5, clima: 8, originalidade: 10, seguranca: 5, custoBaseEUR: 1150, bases: [{ nome: "Himar√´", noites: 4, tipo: "Guest House", destaque: "Praias Secretas" }, { nome: "Ksamil", noites: 4, tipo: "Apto Simples", destaque: "Ilhas G√™meas" }], timeline: [], custos: { hospedagem: 0.35, transporte: 0.15, alimentacao: 0.40, extras: 0.10 } }
        ];

        const KpiCard = ({ title, value, subtext, alertType }) => (
            <div className={`bg-white p-6 rounded-xl card-shadow border-l-4 ${alertType === 'good' ? 'border-green-500' : alertType === 'warning' ? 'border-yellow-500' : alertType === 'danger' ? 'border-red-500' : 'border-blue-500'}`} role="region" aria-label={title}>
                <h3 className="text-gray-600 text-sm font-medium uppercase tracking-wider">{title}</h3>
                <div className="mt-2 text-3xl font-bold text-gray-800">{value}</div>
                <div className="mt-1 text-sm text-gray-600">{subtext}</div>
            </div>
        );

        const App = () => {
            // Authentication
            const [isAuthenticated, setIsAuthenticated] = useState(() => localStorage.getItem('travelAuth') === 'true');
            const [loginUser, setLoginUser] = useState('');
            const [loginPass, setLoginPass] = useState('');
            const [loginError, setLoginError] = useState('');

            // Credentials (simple auth for demo)
            const VALID_USER = 'viagem2026';
            const VALID_PASS = 'mediterraneo';

            const handleLogin = (e) => {
                e.preventDefault();
                if (loginUser === VALID_USER && loginPass === VALID_PASS) {
                    localStorage.setItem('travelAuth', 'true');
                    setIsAuthenticated(true);
                    setLoginError('');
                } else {
                    setLoginError('Usu√°rio ou senha incorretos');
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('travelAuth');
                setIsAuthenticated(false);
            };

            // App states
            const [activeTab, setActiveTab] = useState('overview');
            const [tripName, setTripName] = useState('Viagem Mediterr√¢neo Junho 2026');
            const [selectedId, setSelectedId] = useState('andaluzia');
            const [budgetBRL, setBudgetBRL] = useState(20000);
            const [euroRate, setEuroRate] = useState(6.40);
            const [numDays, setNumDays] = useState(8);
            const [comfortLevel, setComfortLevel] = useState('1'); // FIX: now string
            const [compareList, setCompareList] = useState(['andaluzia', 'istria', 'puglia']);
            const [showCardModal, setShowCardModal] = useState(false);
            // Itinerary states
            const [showItineraryModal, setShowItineraryModal] = useState(false);
            const [itineraryStartDate, setItineraryStartDate] = useState('2026-06-15');
            const [itineraryEndDate, setItineraryEndDate] = useState('2026-06-22');
            const [startArrivalTime, setStartArrivalTime] = useState('tarde');
            const [endDepartureTime, setEndDepartureTime] = useState('tarde');
            // Costs states
            const [showCostsModal, setShowCostsModal] = useState(false);
            const [costOverrides, setCostOverrides] = useState({
                hospedagem: null, transporte: null, alimentacao: null, extras: null,
                passagens: 0, outros: 0
            });
            const numNights = numDays - 1;

            const selectedRoteiro = useMemo(() =>
                ROTEIROS_DATA.find(r => r.id === selectedId) || ROTEIROS_DATA[0],
                [selectedId]);

            const calculateCost = (roteiro) => {
                const daysRatio = numDays / BASELINE_TRIP_DAYS;
                const totalEUR = roteiro.custoBaseEUR * daysRatio * Number(comfortLevel);
                const totalBRL = totalEUR * euroRate;
                return { totalEUR, totalBRL };
            };

            // FIX: Memoize expensive calculations
            const currentCost = useMemo(() => calculateCost(selectedRoteiro), [selectedRoteiro, numDays, comfortLevel, euroRate]);
            const percentUsed = useMemo(() => (currentCost.totalBRL / budgetBRL) * 100, [currentCost.totalBRL, budgetBRL]);

            const pieData = useMemo(() => [
                { name: 'Hospedagem', value: currentCost.totalBRL * selectedRoteiro.custos.hospedagem },
                { name: 'Transporte', value: currentCost.totalBRL * selectedRoteiro.custos.transporte },
                { name: 'Alimenta√ß√£o', value: currentCost.totalBRL * selectedRoteiro.custos.alimentacao },
                { name: 'Extras/Passeios', value: currentCost.totalBRL * selectedRoteiro.custos.extras },
            ], [currentCost.totalBRL, selectedRoteiro.custos]);

            const compareData = useMemo(() => compareList.map(id => {
                const r = ROTEIROS_DATA.find(item => item.id === id);
                if (!r) return null;
                const cost = calculateCost(r);
                return { name: r.nome.split(' ')[0], fullNome: r.nome, Hospedagem: cost.totalBRL * r.custos.hospedagem, Transporte: cost.totalBRL * r.custos.transporte, Alimentacao: cost.totalBRL * r.custos.alimentacao, Extras: cost.totalBRL * r.custos.extras, Total: cost.totalBRL };
            }).filter(Boolean), [compareList, numDays, comfortLevel, euroRate]);

            // FIX: Unified radar data structure
            const radarData = useMemo(() => RADAR_SUBJECTS.map(subject => {
                const base = { subject };
                compareList.forEach(id => {
                    const r = ROTEIROS_DATA.find(i => i.id === id);
                    if (r) {
                        const keyMap = { 'Praia': r.praia, 'Cultura': r.cultura, 'Gastronomia': r.gastronomia, 'Log√≠stica': r.logistica, 'Pet Friendly': r.petFriendly, 'Custo-Benef.': r.custoBeneficio };
                        base[id] = keyMap[subject];
                    }
                });
                return base;
            }), [compareList]);

            // NEW 100-point ranking system with Atratividade (66pts) and Viabilidade (34pts)
            const rankedRoteiros = useMemo(() => {
                return [...ROTEIROS_DATA]
                    .filter(r => r.petFriendly > 2) // ELIMINAT√ìRIO: Exclui Pet Alert CR√çTICO
                    .map(r => {
                        // Bloco A - Atratividade (66 pontos)
                        const atratividade = (r.custoBeneficio * 18 + r.praia * 18 + r.cultura * 6 + r.diversao * 10 + r.gastronomia * 10 + r.originalidade * 4) / ATRATIVIDADE_MAX * 10;
                        // Bloco B - Viabilidade (34 pontos)
                        const viabilidade = (r.logistica * 18 + r.clima * 10 + r.seguranca * 6) / VIABILIDADE_MAX * 10;
                        // Score Total (0-100)
                        const scoreTotal = (r.custoBeneficio * 18 + r.praia * 18 + r.cultura * 6 + r.diversao * 10 + r.gastronomia * 10 + r.originalidade * 4 + r.logistica * 18 + r.clima * 10 + r.seguranca * 6) / 10;
                        return { ...r, atratividade, viabilidade, scoreTotal };
                    })
                    .sort((a, b) => b.scoreTotal - a.scoreTotal);
            }, []);

            const excludedRoteiros = useMemo(() => ROTEIROS_DATA.filter(r => r.petFriendly <= 2), []);

            const renderOverview = () => (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 animate-fade-in">
                    <KpiCard title="Or√ßamento (Casal)" value={`R$ ${budgetBRL.toLocaleString('pt-BR')}`} subtext="Edit√°vel na aba 'Custos'" alertType="neutral" />
                    <KpiCard title="Dura√ß√£o" value={`${numDays} Dias`} subtext={`${numDays - 1} Noites`} alertType="neutral" />
                    <KpiCard title="Roteiro Atual" value={selectedRoteiro.nome.split(' ')[0]} subtext={selectedRoteiro.categoria} alertType="neutral" />
                    <KpiCard title="Status Financeiro" value={`${percentUsed.toFixed(0)}%`} subtext={percentUsed > 100 ? "ACIMA DO OR√áAMENTO" : "Dentro do or√ßamento"} alertType={percentUsed > 100 ? 'danger' : percentUsed > 85 ? 'warning' : 'good'} />
                    <div className="lg:col-span-3 bg-white p-6 rounded-xl card-shadow">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold text-gray-800">Distribui√ß√£o de Custos Estimada</h2>
                            <select className="border rounded-md p-2 text-gray-700 bg-gray-50" value={selectedId} onChange={(e) => setSelectedId(e.target.value)} aria-label="Selecionar roteiro">
                                {ROTEIROS_DATA.map(r => <option key={r.id} value={r.id}>{r.nome}</option>)}
                            </select>
                        </div>
                        <div className="h-64 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart><Pie data={pieData} cx="50%" cy="50%" labelLine={false} outerRadius={80} fill="#8884d8" dataKey="value" label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}>{pieData.map((entry, index) => (<Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />))}</Pie><Tooltip formatter={(value) => `R$ ${value.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}`} /></PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                    <div className="lg:col-span-1 bg-white p-6 rounded-xl card-shadow flex flex-col justify-center space-y-4">
                        <h3 className="font-bold text-gray-700 border-b pb-2">Resumo Financeiro</h3>
                        <div><p className="text-sm text-gray-500">Custo Total (Casal)</p><p className="text-2xl font-bold text-blue-600">‚Ç¨ {currentCost.totalEUR.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</p><p className="text-md text-gray-600">R$ {currentCost.totalBRL.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</p></div>
                        <div><p className="text-sm text-gray-500">Margem (Sobra/Falta)</p><p className={`text-xl font-bold ${budgetBRL - currentCost.totalBRL >= 0 ? 'text-green-600' : 'text-red-500'}`}>R$ {(budgetBRL - currentCost.totalBRL).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</p></div>
                        <div className="pt-4 border-t"><p className="text-xs text-gray-500">Considerando c√¢mbio ‚Ç¨1 = R${euroRate.toFixed(2)}</p></div>
                    </div>
                </div>
            );

            const renderCompare = () => (
                <div className="space-y-6 animate-fade-in">
                    <div className="bg-white p-4 rounded-xl card-shadow">
                        <h3 className="font-bold text-gray-700 mb-3">Selecione para Comparar (Max 4)</h3>
                        <div className="flex flex-wrap gap-4" role="group" aria-label="Sele√ß√£o de roteiros para compara√ß√£o">
                            {ROTEIROS_DATA.slice(0, 8).map(r => (
                                <label key={r.id} className="flex items-center space-x-2 cursor-pointer bg-gray-50 px-3 py-2 rounded-lg hover:bg-gray-100">
                                    <input type="checkbox" checked={compareList.includes(r.id)} onChange={() => { if (compareList.includes(r.id)) { setCompareList(compareList.filter(id => id !== r.id)); } else if (compareList.length < 4) { setCompareList([...compareList, r.id]); } }} className="rounded text-blue-600 focus:ring-blue-500" />
                                    <span className="text-sm font-medium text-gray-700">{r.nome}</span>
                                </label>
                            ))}
                        </div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="bg-white p-6 rounded-xl card-shadow">
                            <h3 className="font-bold text-gray-700 mb-4">Comparativo de Custos (R$)</h3>
                            <div className="h-80"><ResponsiveContainer width="100%" height="100%"><BarChart data={compareData}><CartesianGrid strokeDasharray="3 3" vertical={false} /><XAxis dataKey="name" /><YAxis /><Tooltip formatter={(value) => `R$ ${value.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}`} /><Legend /><Bar dataKey="Hospedagem" stackId="a" fill="#0088FE" /><Bar dataKey="Transporte" stackId="a" fill="#00C49F" /><Bar dataKey="Alimentacao" stackId="a" fill="#FFBB28" /><Bar dataKey="Extras" stackId="a" fill="#FF8042" /></BarChart></ResponsiveContainer></div>
                        </div>
                        <div className="bg-white p-6 rounded-xl card-shadow">
                            <h3 className="font-bold text-gray-700 mb-4">Comparativo de Vibe & Log√≠stica</h3>
                            <div className="h-80"><ResponsiveContainer width="100%" height="100%">
                                <RadarChart outerRadius={90} data={radarData}>
                                    <PolarGrid /><PolarAngleAxis dataKey="subject" tick={{ fontSize: 11 }} /><PolarRadiusAxis angle={30} domain={[0, 5]} />
                                    {compareList.map((id, idx) => { const r = ROTEIROS_DATA.find(i => i.id === id); return r ? <Radar key={id} name={r.nome.split(' ')[0]} dataKey={id} stroke={COLORS[idx % COLORS.length]} fill={COLORS[idx % COLORS.length]} fillOpacity={0.2} /> : null; })}
                                    <Legend /><Tooltip />
                                </RadarChart>
                            </ResponsiveContainer></div>
                        </div>
                    </div>
                </div>
            );

            const renderCards = () => (
                <div className="space-y-6 animate-fade-in">
                    {/* MODAL - Route Selector */}
                    {showCardModal && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={() => setShowCardModal(false)}>
                            <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl" onClick={(e) => e.stopPropagation()}>
                                <div className="bg-gradient-to-r from-blue-600 to-teal-500 p-6 text-white">
                                    <h3 className="text-2xl font-bold">Escolha o Roteiro</h3>
                                    <p className="text-blue-100 mt-1">Clique em um destino para visualizar o card completo</p>
                                </div>
                                <div className="p-4 overflow-y-auto max-h-[60vh]">
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                        {ROTEIROS_DATA.map(r => (
                                            <button key={r.id} onClick={() => { setSelectedId(r.id); setShowCardModal(false); }} className={`text-left p-4 rounded-xl border-2 transition-all hover:shadow-md ${selectedId === r.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-blue-300'}`}>
                                                <div className="flex justify-between items-start">
                                                    <div>
                                                        <h4 className="font-bold text-gray-800">{r.nome}</h4>
                                                        <p className="text-sm text-gray-500">{r.categoria}</p>
                                                    </div>
                                                    <span className="text-lg">‚Ç¨{r.custoBaseEUR}</span>
                                                </div>
                                                <div className="flex gap-2 mt-2 text-xs">
                                                    <span className="bg-cyan-100 text-cyan-700 px-2 py-0.5 rounded">üåä {r.praia}</span>
                                                    <span className="bg-purple-100 text-purple-700 px-2 py-0.5 rounded">üç∑ {r.gastronomia}</span>
                                                    <span className={`px-2 py-0.5 rounded ${r.petFriendly <= 2 ? 'bg-red-100 text-red-700' : r.petFriendly <= 3 ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}`}>üê∂ {r.petFriendly <= 2 ? 'Cr√≠tico' : r.petFriendly <= 3 ? 'M√©dio' : 'OK'}</span>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="border-t p-4 bg-gray-50 flex justify-end">
                                    <button onClick={() => setShowCardModal(false)} className="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">Fechar</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* HERO CARD */}
                    <div className="bg-gradient-to-r from-blue-600 via-blue-500 to-teal-500 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden">
                        <div className="absolute top-4 right-4">
                            <button onClick={() => setShowCardModal(true)} className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>
                                Trocar Roteiro
                            </button>
                        </div>
                        <div className="flex flex-col lg:flex-row justify-between gap-6">
                            <div className="flex-1">
                                <span className="inline-block bg-white/20 px-3 py-1 rounded-full text-sm mb-3">{selectedRoteiro.categoria}</span>
                                <h2 className="text-4xl font-black mb-2">{selectedRoteiro.nome}</h2>
                                <p className="text-blue-100 text-lg max-w-xl">{selectedRoteiro.vibe}</p>
                                <div className="flex gap-3 mt-5 flex-wrap">
                                    <span className="bg-white/20 px-4 py-2 rounded-full text-sm font-medium">üê∂ Pet: {selectedRoteiro.petFriendly}/10</span>
                                    <span className="bg-white/20 px-4 py-2 rounded-full text-sm font-medium">ÔøΩ Praia: {selectedRoteiro.praia}/10</span>
                                    <span className="bg-white/20 px-4 py-2 rounded-full text-sm font-medium">üç∑ Gastro: {selectedRoteiro.gastronomia}/10</span>
                                    <span className="bg-white/20 px-4 py-2 rounded-full text-sm font-medium">‚òÄÔ∏è Clima: {selectedRoteiro.clima}/10</span>
                                </div>
                            </div>
                            <div className="bg-white/10 backdrop-blur rounded-xl p-5 text-center min-w-[180px]">
                                <div className="text-5xl font-black">‚Ç¨{currentCost.totalEUR.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</div>
                                <div className="text-blue-100 text-sm mt-1">Estimado por casal</div>
                                <div className="text-2xl font-bold mt-2">R$ {currentCost.totalBRL.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</div>
                                <div className="text-blue-200 text-xs">{numDays} dias ‚Ä¢ Conforto {comfortLevel === '0.8' ? 'Econ√¥mico' : comfortLevel === '1' ? 'Padr√£o' : 'Luxo'}</div>
                            </div>
                        </div>
                    </div>

                    {/* QUICK STATS */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="bg-white p-4 rounded-xl card-shadow text-center">
                            <div className="text-3xl font-black text-blue-600">{selectedRoteiro.bases.reduce((acc, b) => acc + b.noites, 0)}</div>
                            <div className="text-gray-500 text-sm">Noites Total</div>
                        </div>
                        <div className="bg-white p-4 rounded-xl card-shadow text-center">
                            <div className="text-3xl font-black text-teal-600">{selectedRoteiro.bases.length}</div>
                            <div className="text-gray-500 text-sm">Bases/Cidades</div>
                        </div>
                        <div className="bg-white p-4 rounded-xl card-shadow text-center">
                            <div className="text-3xl font-black text-purple-600">{selectedRoteiro.originalidade}/10</div>
                            <div className="text-gray-500 text-sm">Originalidade</div>
                        </div>
                        <div className="bg-white p-4 rounded-xl card-shadow text-center">
                            <div className="text-3xl font-black text-orange-600">{selectedRoteiro.logistica}/10</div>
                            <div className="text-gray-500 text-sm">Facilidade Log√≠stica</div>
                        </div>
                    </div>

                    {/* BASE CARDS */}
                    <div className="bg-white p-6 rounded-xl card-shadow">
                        <h3 className="font-bold text-gray-800 text-xl mb-4 flex items-center gap-2">
                            <svg className="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            Bases de Hospedagem
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {selectedRoteiro.bases.map((base, idx) => (
                                <div key={idx} className="border-2 border-gray-100 hover:border-blue-200 p-5 rounded-xl transition-colors relative">
                                    <div className="absolute top-3 right-3 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-full">{base.noites} Noites</div>
                                    <div className="flex items-center gap-3 mb-3">
                                        <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-teal-500 rounded-full flex items-center justify-center text-white font-bold">{idx + 1}</div>
                                        <div>
                                            <h4 className="font-bold text-gray-800">{base.nome}</h4>
                                            <span className="text-sm text-gray-500">{base.tipo || 'Apto/Casa'}</span>
                                        </div>
                                    </div>
                                    <div className="bg-yellow-50 border border-yellow-200 p-3 rounded-lg">
                                        <span className="text-xs font-bold text-yellow-700 uppercase">Destaque</span>
                                        <p className="text-gray-700 font-medium">{base.destaque || 'Explora√ß√£o local'}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* EXPERIENCES + RISK/BENEFIT */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-200 p-6 rounded-xl">
                            <h3 className="font-bold text-gray-800 mb-4 flex items-center text-lg">
                                <span className="text-2xl mr-2">‚ú®</span> Experi√™ncias "Uau"
                            </h3>
                            {selectedRoteiro.timeline?.length > 0 ? (
                                <ul className="space-y-2">
                                    {selectedRoteiro.timeline.slice(0, 6).map((day, i) => (
                                        <li key={i} className="flex items-center text-gray-700 bg-white/60 p-2 rounded-lg">
                                            <span className="w-6 h-6 bg-yellow-400 text-yellow-900 rounded-full flex items-center justify-center text-xs font-bold mr-3">D{day.dia}</span>
                                            {day.noite !== '-' ? day.noite : day.tarde}
                                        </li>
                                    ))}
                                </ul>
                            ) : (
                                <p className="text-gray-500 italic">Timeline detalhada n√£o dispon√≠vel. Veja aba Timeline para mais info.</p>
                            )}
                        </div>

                        <div className="bg-white p-6 rounded-xl card-shadow">
                            <h3 className="font-bold text-gray-800 mb-4 text-lg">üìä Perfil do Roteiro</h3>
                            <div className="space-y-3">
                                <div>
                                    <div className="flex justify-between text-sm mb-1"><span>Custo √ó Benef√≠cio</span><span className="font-bold text-blue-600">{selectedRoteiro.custoBeneficio}/10</span></div>
                                    <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-blue-500 h-2 rounded-full" style={{ width: `${selectedRoteiro.custoBeneficio * 10}%` }}></div></div>
                                </div>
                                <div>
                                    <div className="flex justify-between text-sm mb-1"><span>Divers√£o / Vibe</span><span className="font-bold text-orange-600">{selectedRoteiro.diversao}/10</span></div>
                                    <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-orange-500 h-2 rounded-full" style={{ width: `${selectedRoteiro.diversao * 10}%` }}></div></div>
                                </div>
                                <div>
                                    <div className="flex justify-between text-sm mb-1"><span>Seguran√ßa</span><span className="font-bold text-green-600">{selectedRoteiro.seguranca}/10</span></div>
                                    <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-green-500 h-2 rounded-full" style={{ width: `${selectedRoteiro.seguranca * 10}%` }}></div></div>
                                </div>
                                <div>
                                    <div className="flex justify-between text-sm mb-1"><span>Cultura</span><span className="font-bold text-purple-600">{selectedRoteiro.cultura}/10</span></div>
                                    <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-purple-500 h-2 rounded-full" style={{ width: `${selectedRoteiro.cultura * 10}%` }}></div></div>
                                </div>
                            </div>
                            <div className="mt-4 pt-4 border-t">
                                {selectedRoteiro.petFriendly <= 2 ? (
                                    <div className="flex items-center gap-2 text-red-600 bg-red-50 p-3 rounded-lg"><span className="text-xl">‚ö†Ô∏è</span><div><strong>Pet Alert: CR√çTICO</strong><p className="text-xs">Risco de quarentena ou restri√ß√µes na fronteira</p></div></div>
                                ) : selectedRoteiro.petFriendly <= 3 ? (
                                    <div className="flex items-center gap-2 text-yellow-700 bg-yellow-50 p-3 rounded-lg"><span className="text-xl">‚ö°</span><div><strong>Pet Alert: M√âDIO</strong><p className="text-xs">Requer aten√ß√£o com documenta√ß√£o</p></div></div>
                                ) : (
                                    <div className="flex items-center gap-2 text-green-700 bg-green-50 p-3 rounded-lg"><span className="text-xl">‚úÖ</span><div><strong>Pet Alert: OK</strong><p className="text-xs">Sem restri√ß√µes significativas</p></div></div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderRanking = () => (
                <div className="animate-fade-in space-y-6">
                    {/* SUMMARY CARDS - Top 3 */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {rankedRoteiros.slice(0, 3).map((r, idx) => (
                            <div key={r.id} className={`bg-gradient-to-br ${idx === 0 ? 'from-yellow-400 to-orange-500' : idx === 1 ? 'from-gray-300 to-gray-400' : 'from-amber-600 to-amber-700'} rounded-xl p-5 text-white shadow-lg`}>
                                <div className="flex justify-between items-start mb-3">
                                    <span className="text-3xl font-bold">#{idx + 1}</span>
                                    <span className="text-4xl font-black">{r.scoreTotal.toFixed(0)}</span>
                                </div>
                                <h3 className="text-lg font-bold mb-1">{r.nome}</h3>
                                <p className="text-white/80 text-sm mb-3">{r.categoria}</p>
                                <div className="grid grid-cols-2 gap-2 text-sm">
                                    <div className="bg-white/20 rounded px-2 py-1">
                                        <span className="block text-white/70 text-xs">üí´ Atratividade</span>
                                        <span className="font-bold">{r.atratividade.toFixed(0)}/100</span>
                                    </div>
                                    <div className="bg-white/20 rounded px-2 py-1">
                                        <span className="block text-white/70 text-xs">‚úÖ Viabilidade</span>
                                        <span className="font-bold">{r.viabilidade.toFixed(0)}/100</span>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* DETAILED TABLE */}
                    <div className="bg-white p-6 rounded-xl card-shadow">
                        <div className="mb-4">
                            <h2 className="text-2xl font-bold text-gray-800">Ranking Completo (Eleg√≠veis)</h2>
                            <p className="text-gray-500 text-sm">Somente roteiros com Pet Alert OK ou M√âDIO. Escala 0-10 por crit√©rio.</p>
                        </div>
                        <div className="overflow-x-auto">
                            <table className="min-w-full text-xs">
                                <thead>
                                    <tr className="bg-slate-50 border-b-2 border-slate-200">
                                        <th rowSpan="2" className="px-2 py-2 text-left font-bold text-slate-700">#</th>
                                        <th rowSpan="2" className="px-2 py-2 text-left font-bold text-slate-700">Destino</th>
                                        <th colSpan="6" className="px-2 py-2 text-center font-bold text-blue-600 bg-blue-50 border-l border-slate-200">üîµ ATRATIVIDADE (66pts)</th>
                                        <th colSpan="3" className="px-2 py-2 text-center font-bold text-orange-600 bg-orange-50 border-l border-slate-200">üü† VIABILIDADE (34pts)</th>
                                        <th colSpan="3" className="px-2 py-2 text-center font-bold text-slate-700 bg-slate-100 border-l border-slate-200">SCORES</th>
                                    </tr>
                                    <tr className="bg-slate-100 text-slate-500 uppercase text-[10px] tracking-wider">
                                        <th className="px-2 py-1 text-center border-l border-slate-200">C√óB<br /><span className="text-blue-500">18</span></th>
                                        <th className="px-2 py-1 text-center">Praia<br /><span className="text-blue-500">18</span></th>
                                        <th className="px-2 py-1 text-center">Cultura<br /><span className="text-blue-500">6</span></th>
                                        <th className="px-2 py-1 text-center">Divers√£o<br /><span className="text-blue-500">10</span></th>
                                        <th className="px-2 py-1 text-center">Gastro<br /><span className="text-blue-500">10</span></th>
                                        <th className="px-2 py-1 text-center">Original<br /><span className="text-blue-500">4</span></th>
                                        <th className="px-2 py-1 text-center border-l border-slate-200">Log√≠st.<br /><span className="text-orange-500">18</span></th>
                                        <th className="px-2 py-1 text-center">Clima<br /><span className="text-orange-500">10</span></th>
                                        <th className="px-2 py-1 text-center">Segur.<br /><span className="text-orange-500">6</span></th>
                                        <th className="px-2 py-1 text-center border-l border-slate-200 bg-blue-100">Atrat.</th>
                                        <th className="px-2 py-1 text-center bg-orange-100">Viab.</th>
                                        <th className="px-2 py-1 text-center bg-green-100 font-bold">TOTAL</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100">
                                    {rankedRoteiros.map((r, idx) => (
                                        <tr key={r.id} className={`hover:bg-slate-50 ${idx < 3 ? 'bg-green-50/30' : ''}`}>
                                            <td className="px-2 py-2 font-bold text-slate-400">{idx + 1}</td>
                                            <td className="px-2 py-2 font-semibold text-slate-800 whitespace-nowrap">{r.nome.length > 20 ? r.nome.substring(0, 20) + '...' : r.nome}</td>
                                            <td className="px-2 py-2 text-center border-l border-slate-100"><span className="inline-block w-6 h-6 rounded-full bg-blue-100 text-blue-700 font-bold leading-6">{r.custoBeneficio}</span></td>
                                            <td className="px-2 py-2 text-center"><span className="inline-block w-6 h-6 rounded-full bg-cyan-100 text-cyan-700 font-bold leading-6">{r.praia}</span></td>
                                            <td className="px-2 py-2 text-center"><span className="inline-block w-6 h-6 rounded-full bg-purple-100 text-purple-700 font-bold leading-6">{r.cultura}</span></td>
                                            <td className="px-2 py-2 text-center"><span className="inline-block w-6 h-6 rounded-full bg-orange-100 text-orange-700 font-bold leading-6">{r.diversao}</span></td>
                                            <td className="px-2 py-2 text-center"><span className="inline-block w-6 h-6 rounded-full bg-red-100 text-red-700 font-bold leading-6">{r.gastronomia}</span></td>
                                            <td className="px-2 py-2 text-center"><span className="inline-block w-6 h-6 rounded-full bg-pink-100 text-pink-700 font-bold leading-6">{r.originalidade}</span></td>
                                            <td className="px-2 py-2 text-center border-l border-slate-100"><span className="inline-block w-6 h-6 rounded-full bg-amber-100 text-amber-700 font-bold leading-6">{r.logistica}</span></td>
                                            <td className="px-2 py-2 text-center"><span className="inline-block w-6 h-6 rounded-full bg-yellow-100 text-yellow-700 font-bold leading-6">{r.clima}</span></td>
                                            <td className="px-2 py-2 text-center"><span className="inline-block w-6 h-6 rounded-full bg-green-100 text-green-700 font-bold leading-6">{r.seguranca}</span></td>
                                            <td className="px-2 py-2 text-center border-l border-slate-100 font-bold text-blue-600 bg-blue-50">{r.atratividade.toFixed(0)}</td>
                                            <td className="px-2 py-2 text-center font-bold text-orange-600 bg-orange-50">{r.viabilidade.toFixed(0)}</td>
                                            <td className="px-2 py-2 text-center font-black text-lg text-green-700 bg-green-100">{r.scoreTotal.toFixed(0)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {/* EXCLUDED ROUTES */}
                        {excludedRoteiros.length > 0 && (
                            <div className="mt-6 p-4 bg-red-50 rounded-lg border border-red-200">
                                <h4 className="font-bold text-red-700 mb-2">üö´ Exclu√≠dos do Ranking (Pet Alert CR√çTICO)</h4>
                                <div className="flex flex-wrap gap-2">
                                    {excludedRoteiros.map(r => (
                                        <span key={r.id} className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium">{r.nome}</span>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* FORMULA EXPLANATION */}
                        <div className="mt-6 p-4 bg-slate-50 rounded-lg border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-3">üìê Sistema de Pontua√ß√£o (0-100)</h4>
                            <div className="grid md:grid-cols-2 gap-4 text-sm text-slate-600">
                                <div className="bg-blue-50 p-3 rounded-lg">
                                    <h5 className="font-bold text-blue-700 mb-2">üîµ Bloco A - Atratividade (66%)</h5>
                                    <ul className="space-y-1 text-xs">
                                        <li>üíé <strong>Custo√óBenef√≠cio:</strong> peso 18 (Alto)</li>
                                        <li>üåä <strong>Praia:</strong> peso 18 (Alto)</li>
                                        <li>üç∑ <strong>Cultura:</strong> peso 6 (Normal)</li>
                                        <li>üéâ <strong>Divers√£o:</strong> peso 10 (Intermedi√°rio)</li>
                                        <li>üçù <strong>Gastronomia:</strong> peso 10 (Intermedi√°rio)</li>
                                        <li>‚ú® <strong>Originalidade:</strong> peso 4 (Normal)</li>
                                    </ul>
                                </div>
                                <div className="bg-orange-50 p-3 rounded-lg">
                                    <h5 className="font-bold text-orange-700 mb-2">üü† Bloco B - Viabilidade (34%)</h5>
                                    <ul className="space-y-1 text-xs">
                                        <li>‚úàÔ∏è <strong>Log√≠stica + Risco:</strong> peso 18 (Alto)</li>
                                        <li>‚òÄÔ∏è <strong>Clima:</strong> peso 10 (Intermedi√°rio)</li>
                                        <li>üõ°Ô∏è <strong>Seguran√ßa:</strong> peso 6 (Normal)</li>
                                    </ul>
                                    <p className="mt-2 text-xs text-orange-600 font-medium">‚ö†Ô∏è Pet Alert CR√çTICO = eliminat√≥rio</p>
                                </div>
                            </div>
                            <p className="mt-3 text-xs text-slate-500 italic">F√≥rmula: Score = Œ£(Nota √ó Peso) √∑ 10 ‚Üí Cada nota √© de 0-10, soma dos pesos = 100</p>
                        </div>
                    </div>
                </div>
            );

            const renderCosts = () => {
                // Calculate default values
                const defaultCosts = {
                    hospedagem: currentCost.totalBRL * selectedRoteiro.custos.hospedagem,
                    transporte: currentCost.totalBRL * selectedRoteiro.custos.transporte,
                    alimentacao: currentCost.totalBRL * selectedRoteiro.custos.alimentacao,
                    extras: currentCost.totalBRL * selectedRoteiro.custos.extras
                };

                // Get current values (override or default)
                const getCostValue = (key) => costOverrides[key] !== null ? costOverrides[key] : defaultCosts[key];
                const isOverridden = (key) => costOverrides[key] !== null;

                // Reset single field
                const resetField = (key) => setCostOverrides(prev => ({ ...prev, [key]: null }));

                // Reset all fields
                const resetAllCosts = () => setCostOverrides({
                    hospedagem: null, transporte: null, alimentacao: null, extras: null,
                    passagens: 0, outros: 0
                });

                // Calculate totals
                const subtotalRoteiro = getCostValue('hospedagem') + getCostValue('transporte') + getCostValue('alimentacao') + getCostValue('extras');
                const totalGeral = subtotalRoteiro + costOverrides.passagens + costOverrides.outros;
                const percentUsedTotal = (totalGeral / budgetBRL) * 100;

                return (
                    <div className="space-y-6 animate-fade-in">
                        {/* COSTS MODAL */}
                        {showCostsModal && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={() => setShowCostsModal(false)}>
                                <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl" onClick={(e) => e.stopPropagation()}>
                                    <div className="bg-gradient-to-r from-green-600 to-emerald-500 p-6 text-white">
                                        <h3 className="text-2xl font-bold">Escolha o Roteiro</h3>
                                        <p className="text-green-100 mt-1">Selecione qual roteiro deseja calcular os custos</p>
                                    </div>
                                    <div className="p-4 overflow-y-auto max-h-[60vh]">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            {ROTEIROS_DATA.map(r => (
                                                <button key={r.id} onClick={() => { setSelectedId(r.id); setShowCostsModal(false); resetAllCosts(); }} className={`text-left p-4 rounded-xl border-2 transition-all hover:shadow-md ${selectedId === r.id ? 'border-green-500 bg-green-50' : 'border-gray-200 hover:border-green-300'}`}>
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <h4 className="font-bold text-gray-800">{r.nome}</h4>
                                                            <p className="text-sm text-gray-500">{r.categoria}</p>
                                                        </div>
                                                        <span className="text-lg font-bold text-green-600">‚Ç¨{r.custoBaseEUR}</span>
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="border-t p-4 bg-gray-50 flex justify-end">
                                        <button onClick={() => setShowCostsModal(false)} className="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">Fechar</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* PARAMETERS PANEL */}
                        <div className="bg-white p-6 rounded-xl card-shadow">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800">üí∞ Calculadora de Custos</h2>
                                    <p className="text-gray-500">Personalize os par√¢metros e edite os valores estimados</p>
                                </div>
                                <button onClick={() => setShowCostsModal(true)} className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>
                                    Trocar Roteiro
                                </button>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">üíµ Or√ßamento (R$)</label>
                                    <input type="number" value={budgetBRL} onChange={(e) => setBudgetBRL(Number(e.target.value))} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">üí∂ Cota√ß√£o Euro (R$)</label>
                                    <input type="number" step="0.05" value={euroRate} onChange={(e) => setEuroRate(Number(e.target.value))} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">üåô Noites</label>
                                    <input type="number" value={numNights} onChange={(e) => setNumDays(Number(e.target.value) + 1)} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">‚≠ê N√≠vel de Conforto</label>
                                    <select value={comfortLevel} onChange={(e) => setComfortLevel(e.target.value)} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none bg-white">
                                        <option value="0.8">Econ√¥mico</option>
                                        <option value="1">Padr√£o</option>
                                        <option value="1.3">Luxo</option>
                                    </select>
                                </div>
                                <div className="flex items-end">
                                    <button onClick={resetAllCosts} className="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                        Resetar Valores
                                    </button>
                                </div>
                            </div>
                            <div className="mt-4 flex flex-wrap gap-3 text-sm">
                                <div className="bg-green-100 text-green-700 px-4 py-2 rounded-lg font-medium">
                                    Roteiro: <span className="font-bold">{selectedRoteiro.nome}</span>
                                </div>
                                <div className="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg">
                                    Base: <span className="font-bold">‚Ç¨{selectedRoteiro.custoBaseEUR}</span> ({numNights} noites)
                                </div>
                            </div>
                        </div>

                        {/* EDITABLE COSTS TABLE */}
                        <div className="bg-white p-6 rounded-xl card-shadow overflow-x-auto">
                            <h3 className="font-bold text-gray-800 text-xl mb-4 flex items-center gap-2">
                                <svg className="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                Detalhamento para {selectedRoteiro.nome}
                            </h3>
                            <table className="min-w-full text-left text-sm">
                                <thead>
                                    <tr className="bg-gray-50 border-b">
                                        <th className="p-3 font-semibold text-gray-600">Categoria</th>
                                        <th className="p-3 font-semibold text-gray-600">Por Casal (R$)</th>
                                        <th className="p-3 font-semibold text-gray-600">Grupo 4 (R$)</th>
                                        <th className="p-3 font-semibold text-gray-600">Por Pessoa/Noite</th>
                                        <th className="p-3 font-semibold text-gray-600 text-center">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y">
                                    {[
                                        { key: 'hospedagem', cat: 'üè† Hospedagem (Villas)', desc: 'Aluguel de casa/apto' },
                                        { key: 'transporte', cat: 'üöó Transporte Local', desc: 'Carro, gasolina, ped√°gios' },
                                        { key: 'alimentacao', cat: 'üçΩÔ∏è Alimenta√ß√£o', desc: 'Mercado + Restaurantes' },
                                        { key: 'extras', cat: 'üéüÔ∏è Passeios e Extras', desc: 'Entradas, tours, atividades' }
                                    ].map((row) => {
                                        const valCasal = getCostValue(row.key);
                                        const valGrupo = valCasal * 2;
                                        const valPessoaNoite = valCasal / 2 / numNights;
                                        return (
                                            <tr key={row.key} className={`hover:bg-gray-50 ${isOverridden(row.key) ? 'bg-yellow-50' : ''}`}>
                                                <td className="p-3">
                                                    <div className="font-medium text-gray-800">{row.cat}</div>
                                                    <div className="text-xs text-gray-500">{row.desc}</div>
                                                </td>
                                                <td className="p-3">
                                                    <input type="number" value={Math.round(valCasal)} onChange={(e) => setCostOverrides(prev => ({ ...prev, [row.key]: Number(e.target.value) }))} className={`w-28 border rounded-lg p-2 font-bold ${isOverridden(row.key) ? 'border-yellow-400 bg-yellow-50 text-yellow-700' : 'border-gray-200 text-green-700'}`} />
                                                </td>
                                                <td className="p-3 text-gray-600">R$ {valGrupo.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                                <td className="p-3 text-gray-600">R$ {valPessoaNoite.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                                <td className="p-3 text-center">
                                                    {isOverridden(row.key) && (
                                                        <button onClick={() => resetField(row.key)} className="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded" title="Voltar ao valor padr√£o">‚Ü©Ô∏è Reset</button>
                                                    )}
                                                </td>
                                            </tr>
                                        );
                                    })}
                                    <tr className="bg-gray-50 border-t-2">
                                        <td className="p-3 font-bold text-gray-700">üìä Subtotal Roteiro</td>
                                        <td className="p-3 font-bold text-gray-700">R$ {subtotalRoteiro.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td className="p-3 text-gray-600">R$ {(subtotalRoteiro * 2).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td className="p-3 text-gray-600">R$ {(subtotalRoteiro / 2 / numNights).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td></td>
                                    </tr>
                                    <tr className="bg-blue-50/50">
                                        <td className="p-3">
                                            <div className="font-medium text-gray-800">‚úàÔ∏è Passagens A√©reas</div>
                                            <div className="text-xs text-gray-500">Voos ida e volta (n√£o incluso acima)</div>
                                        </td>
                                        <td className="p-3">
                                            <input type="number" value={costOverrides.passagens} onChange={(e) => setCostOverrides(prev => ({ ...prev, passagens: Number(e.target.value) }))} className="w-28 border border-blue-300 rounded-lg p-2 font-bold text-blue-700 bg-blue-50" placeholder="0" />
                                        </td>
                                        <td className="p-3 text-gray-600">R$ {(costOverrides.passagens * 2).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td className="p-3 text-gray-400 italic">-</td>
                                        <td></td>
                                    </tr>
                                    <tr className="bg-purple-50/50">
                                        <td className="p-3">
                                            <div className="font-medium text-gray-800">üì¶ Outros Custos</div>
                                            <div className="text-xs text-gray-500">Seguro viagem, chips, etc</div>
                                        </td>
                                        <td className="p-3">
                                            <input type="number" value={costOverrides.outros} onChange={(e) => setCostOverrides(prev => ({ ...prev, outros: Number(e.target.value) }))} className="w-28 border border-purple-300 rounded-lg p-2 font-bold text-purple-700 bg-purple-50" placeholder="0" />
                                        </td>
                                        <td className="p-3 text-gray-600">R$ {(costOverrides.outros * 2).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td className="p-3 text-gray-400 italic">-</td>
                                        <td></td>
                                    </tr>
                                    <tr className="bg-green-100 font-bold border-t-2 border-green-300">
                                        <td className="p-3 text-gray-800 text-lg">üí∞ TOTAL GERAL</td>
                                        <td className="p-3 text-green-700 text-xl">R$ {totalGeral.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td className="p-3 text-gray-800">R$ {(totalGeral * 2).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td className="p-3 text-gray-800">R$ {(totalGeral / 2 / numNights).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        {/* BUDGET HEALTH */}
                        <div className="bg-white p-6 rounded-xl card-shadow">
                            <h3 className="font-bold text-gray-700 mb-2">üìä Sa√∫de do Or√ßamento (Teto R$ {budgetBRL.toLocaleString()})</h3>
                            <div className="w-full bg-gray-200 rounded-full h-6 relative overflow-hidden" role="progressbar" aria-valuenow={percentUsedTotal} aria-valuemin="0" aria-valuemax="100">
                                <div className={`h-6 rounded-full transition-all duration-500 ${percentUsedTotal > 100 ? 'bg-red-500' : percentUsedTotal > 85 ? 'bg-yellow-400' : 'bg-green-500'}`} style={{ width: `${Math.min(percentUsedTotal, 100)}%` }}></div>
                            </div>
                            <div className="flex justify-between text-xs text-gray-500 mt-1">
                                <span>0%</span>
                                <span className="font-medium">Uso Atual: {percentUsedTotal.toFixed(1)}% (R$ {totalGeral.toLocaleString('pt-BR', { maximumFractionDigits: 0 })} de R$ {budgetBRL.toLocaleString()})</span>
                                <span>100%</span>
                            </div>
                            {percentUsedTotal > 100 && (
                                <div className="mt-3 p-3 bg-red-100 text-red-700 rounded-lg text-sm flex items-center" role="alert">
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                    <strong>Alerta:</strong>&nbsp;Voc√™ estourou o or√ßamento em R$ {(totalGeral - budgetBRL).toLocaleString('pt-BR', { maximumFractionDigits: 0 })}. Revise os valores ou aumente o or√ßamento.
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const renderItinerary = () => {
                // Calculate days between dates
                const startDate = new Date(itineraryStartDate);
                const endDate = new Date(itineraryEndDate);
                const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                const timeLabels = { manha: 'üåÖ Manh√£', tarde: '‚òÄÔ∏è Tarde', noite: 'üåô Noite' };

                // Generate calendar-like itinerary (using IIFE, not useMemo - hooks can't be in render functions)
                const generatedItinerary = (() => {
                    const days = [];
                    const baseTimeline = selectedRoteiro.timeline || [];
                    for (let i = 0; i < daysDiff; i++) {
                        const date = new Date(startDate);
                        date.setDate(date.getDate() + i);
                        const dayData = baseTimeline[i] || {};
                        const isFirstDay = i === 0;
                        const isLastDay = i === daysDiff - 1;
                        days.push({
                            dayNum: i + 1,
                            date: date.toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: 'short' }),
                            cidade: dayData.cidade || selectedRoteiro.bases[Math.min(Math.floor(i / 4), selectedRoteiro.bases.length - 1)]?.nome || 'Transfer',
                            manha: isFirstDay && startArrivalTime !== 'manha' ? (startArrivalTime === 'tarde' ? '‚úàÔ∏è Em tr√¢nsito' : '‚úàÔ∏è Em tr√¢nsito') : (dayData.manha || 'Explorar regi√£o'),
                            tarde: isFirstDay && startArrivalTime === 'noite' ? '‚úàÔ∏è Chegada ao destino' : (dayData.tarde || 'Passeio livre'),
                            noite: isLastDay && endDepartureTime === 'noite' ? '‚úàÔ∏è Partida' : (dayData.noite || 'Jantar local'),
                            isFirstDay,
                            isLastDay,
                            isArrival: isFirstDay,
                            isDeparture: isLastDay
                        });
                    }
                    return days;
                })();

                return (
                    <div className="space-y-6 animate-fade-in">
                        {/* ITINERARY MODAL */}
                        {showItineraryModal && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={() => setShowItineraryModal(false)}>
                                <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl" onClick={(e) => e.stopPropagation()}>
                                    <div className="bg-gradient-to-r from-indigo-600 to-purple-500 p-6 text-white">
                                        <h3 className="text-2xl font-bold">Escolha o Roteiro</h3>
                                        <p className="text-indigo-100 mt-1">Selecione qual roteiro deseja visualizar o itiner√°rio</p>
                                    </div>
                                    <div className="p-4 overflow-y-auto max-h-[60vh]">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            {ROTEIROS_DATA.map(r => (
                                                <button key={r.id} onClick={() => { setSelectedId(r.id); setShowItineraryModal(false); }} className={`text-left p-4 rounded-xl border-2 transition-all hover:shadow-md ${selectedId === r.id ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:border-indigo-300'}`}>
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <h4 className="font-bold text-gray-800">{r.nome}</h4>
                                                            <p className="text-sm text-gray-500">{r.categoria}</p>
                                                        </div>
                                                        {r.timeline?.length > 0 && <span className="bg-green-100 text-green-700 text-xs px-2 py-1 rounded">‚úì Timeline</span>}
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="border-t p-4 bg-gray-50 flex justify-end">
                                        <button onClick={() => setShowItineraryModal(false)} className="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">Fechar</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* PARAMETERS PANEL */}
                        <div className="bg-white p-6 rounded-xl card-shadow">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800">üìÖ Itiner√°rio Personalizado</h2>
                                    <p className="text-gray-500">Configure as datas e hor√°rios para gerar seu roteiro</p>
                                </div>
                                <button onClick={() => setShowItineraryModal(true)} className="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>
                                    Trocar Roteiro
                                </button>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">üìÜ Data de In√≠cio</label>
                                    <input type="date" value={itineraryStartDate} onChange={(e) => setItineraryStartDate(e.target.value)} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">üïê Chegada</label>
                                    <select value={startArrivalTime} onChange={(e) => setStartArrivalTime(e.target.value)} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                                        <option value="manha">üåÖ Manh√£ (antes 12h)</option>
                                        <option value="tarde">‚òÄÔ∏è Tarde (12h-18h)</option>
                                        <option value="noite">üåô Noite (ap√≥s 18h)</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">üìÜ Data de T√©rmino</label>
                                    <input type="date" value={itineraryEndDate} onChange={(e) => setItineraryEndDate(e.target.value)} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">üïê Partida</label>
                                    <select value={endDepartureTime} onChange={(e) => setEndDepartureTime(e.target.value)} className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                                        <option value="manha">üåÖ Manh√£ (antes 12h)</option>
                                        <option value="tarde">‚òÄÔ∏è Tarde (12h-18h)</option>
                                        <option value="noite">üåô Noite (ap√≥s 18h)</option>
                                    </select>
                                </div>
                            </div>

                            <div className="mt-4 flex flex-wrap gap-4 items-center text-sm">
                                <div className="bg-indigo-100 text-indigo-700 px-4 py-2 rounded-lg font-medium">
                                    <span className="font-bold">{daysDiff}</span> dias de viagem
                                </div>
                                <div className="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg">
                                    Roteiro: <span className="font-bold">{selectedRoteiro.nome}</span>
                                </div>
                                <div className="bg-green-100 text-green-700 px-4 py-2 rounded-lg">
                                    Chegada: {timeLabels[startArrivalTime]} ‚Üí Partida: {timeLabels[endDepartureTime]}
                                </div>
                            </div>
                        </div>

                        {/* ITINERARY DISPLAY */}
                        <div className="bg-white p-6 rounded-xl card-shadow">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="font-bold text-gray-800 text-xl flex items-center gap-2">
                                    <svg className="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                                    Roteiro Dia-a-Dia: {selectedRoteiro.nome}
                                </h3>
                                <button onClick={() => window.print()} className="text-indigo-600 text-sm hover:underline flex items-center" aria-label="Imprimir roteiro">
                                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                                    Imprimir / PDF
                                </button>
                            </div>

                            <div className="space-y-4">
                                {generatedItinerary.map((item, idx) => (
                                    <div key={idx} className={`flex flex-col md:flex-row border-l-4 ${item.isFirstDay ? 'border-green-500 bg-green-50/30' : item.isLastDay ? 'border-red-500 bg-red-50/30' : 'border-indigo-300'} rounded-lg p-4 ${idx !== generatedItinerary.length - 1 ? 'mb-2' : ''}`}>
                                        <div className="md:w-36 flex-shrink-0 mb-3 md:mb-0">
                                            <div className="font-black text-indigo-600 text-xl">DIA {item.dayNum}</div>
                                            <div className="text-gray-500 text-sm font-medium">{item.date}</div>
                                            <div className="text-gray-700 text-sm mt-1">üìç {item.cidade}</div>
                                            {item.isFirstDay && <span className="inline-block mt-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full">‚úàÔ∏è CHEGADA</span>}
                                            {item.isLastDay && <span className="inline-block mt-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">‚úàÔ∏è PARTIDA</span>}
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3 w-full">
                                            <div className={`p-3 rounded-lg ${item.isFirstDay && startArrivalTime !== 'manha' ? 'bg-gray-200 text-gray-500 italic' : 'bg-yellow-50 border border-yellow-200'}`}>
                                                <span className="text-xs font-bold text-yellow-600 uppercase block mb-1">üåÖ Manh√£</span>
                                                <p className="text-gray-800 font-medium text-sm">{item.manha}</p>
                                            </div>
                                            <div className={`p-3 rounded-lg ${item.isFirstDay && startArrivalTime === 'noite' ? 'bg-gray-200 text-gray-500 italic' : 'bg-orange-50 border border-orange-200'}`}>
                                                <span className="text-xs font-bold text-orange-600 uppercase block mb-1">‚òÄÔ∏è Tarde</span>
                                                <p className="text-gray-800 font-medium text-sm">{item.tarde}</p>
                                            </div>
                                            <div className={`p-3 rounded-lg ${item.isLastDay && endDepartureTime !== 'noite' ? 'bg-gray-200 text-gray-500 italic' : 'bg-indigo-50 border border-indigo-200'}`}>
                                                <span className="text-xs font-bold text-indigo-600 uppercase block mb-1">üåô Noite</span>
                                                <p className="text-gray-800 font-medium text-sm">{item.noite}</p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {!selectedRoteiro.timeline?.length && (
                                <div className="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-700 text-sm">
                                    <strong>‚ö° Nota:</strong> Este roteiro usa itiner√°rio gen√©rico. Roteiros com timeline completa (Andaluzia, Istria, etc) mostram atividades detalhadas.
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // LOGIN SCREEN
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 via-blue-500 to-teal-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
                            <div className="text-center mb-8">
                                <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-teal-500 rounded-full mx-auto flex items-center justify-center mb-4">
                                    <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <h1 className="text-2xl font-bold text-gray-800">Otimizador de Viagens</h1>
                                <p className="text-gray-500 mt-2">Mediterr√¢neo 2026</p>
                            </div>
                            <form onSubmit={handleLogin} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Usu√°rio</label>
                                    <input type="text" value={loginUser} onChange={(e) => setLoginUser(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors" placeholder="Digite seu usu√°rio" autoFocus />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                                    <input type="password" value={loginPass} onChange={(e) => setLoginPass(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors" placeholder="Digite sua senha" />
                                </div>
                                {loginError && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-center">
                                        <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                        {loginError}
                                    </div>
                                )}
                                <button type="submit" className="w-full bg-gradient-to-r from-blue-600 to-teal-500 text-white font-bold py-3 px-4 rounded-lg hover:from-blue-700 hover:to-teal-600 transition-all shadow-lg hover:shadow-xl">
                                    Entrar
                                </button>
                            </form>
                            <p className="text-center text-gray-400 text-xs mt-6">Acesso restrito aos organizadores da viagem</p>
                        </div>
                    </div>
                );
            }

            // MAIN DASHBOARD (authenticated)
            return (
                <div className="min-h-screen bg-slate-100 text-gray-800 pb-12">
                    <header className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                            <div className="flex items-center">
                                <svg className="w-8 h-8 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <div>
                                    <h1 className="text-xl font-bold text-gray-900 leading-none">Otimizador de Viagens</h1>
                                    <input className="text-xs text-gray-500 bg-transparent border-none p-0 focus:ring-0 w-64" value={tripName} onChange={(e) => setTripName(e.target.value)} aria-label="Nome da viagem" />
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="text-sm font-medium text-gray-500 hidden sm:block">Mediterr√¢neo ‚Ä¢ Junho 2026</span>
                                <button onClick={handleLogout} className="bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1">
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                    Sair
                                </button>
                            </div>
                        </div>
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-2">
                            <nav className="flex space-x-8 overflow-x-auto" aria-label="Tabs" role="tablist">
                                {['Overview', 'Ranking', 'Comparar', 'Cards', 'Custos', 'Itiner√°rio'].map((tab) => (
                                    <button key={tab} onClick={() => setActiveTab(tab.toLowerCase())} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors ${activeTab === tab.toLowerCase() ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`} role="tab" aria-selected={activeTab === tab.toLowerCase()}>{tab}</button>
                                ))}
                            </nav>
                        </div>
                    </header>
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {activeTab === 'overview' && renderOverview()}
                        {activeTab === 'ranking' && renderRanking()}
                        {activeTab === 'comparar' && renderCompare()}
                        {activeTab === 'cards' && renderCards()}
                        {activeTab === 'custos' && renderCosts()}
                        {activeTab === 'itiner√°rio' && renderItinerary()}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>